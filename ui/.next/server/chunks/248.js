"use strict";exports.id=248,exports.ids=[248],exports.modules={8248:(t,n,i)=>{i.r(n),i.d(n,{CommentsAnnotationPin:()=>p});var e=i(8782),o=i(6955),s=i(746);i(3128);var a=i(459),r=i(8882),l=i(7128);(0,o.e)();var d=(0,r.D)(l.a),c=[d.styles,e.c],p=class extends d{constructor(){super(),this.focusInput=()=>{var t,n;this.inputElement||(this.inputElement=null==(n=null==(t=this.shadowRoot)?void 0:t.querySelector("superviz-comments-comment-input"))?void 0:n.shadowRoot.querySelector("textarea")),this.inputElement.focus()},this.setInputSide=()=>{let t="right"===this.commentsSide?320:0,n=this.annotationSides.right+293,i=this.containerSides.right-t;if(n<i){this.horizontalSide="right";return}t="left"===this.commentsSide?320:0;let e=this.annotationSides.left-293,o=this.containerSides.left+t;if(e>o){this.horizontalSide="left";return}this.horizontalSide=o-e>n-i?"right":"left"},this.createComment=({detail:t})=>{this.annotationSent=!0,document.body.dispatchEvent(new CustomEvent("create-annotation",{detail:(0,o.y)((0,o.x)({},t),{position:(0,o.y)((0,o.x)({},this.originalPosition),{type:"canvas"})})})),this.annotation=null},this.cancelTemporaryAnnotation=()=>{this.annotation=null},this.cancelTemporaryAnnotationEsc=t=>{this.annotation=null},this.avatar=()=>{if("add"===this.type&&!this.showInput)return(0,l.V)`<div
        class="comments__annotation-pin__avatar comments__annotation-pin__avatar--add"
      >
        <superviz-icon name="add"></superviz-icon>
      </div>`;let t=this.userAvatar;return t?(0,l.V)`<div class="comments__annotation-pin__avatar">
        <img src=${t} />
      </div>`:(0,l.V)`<div class="comments__annotation-pin__avatar">
      <p class="text text-bold text-big">${this.userInitial}</p>
    </div>`},this.input=()=>{if(!(!this.showInput||this.annotationSent))return(0,l.V)`<div class="floating-input">
      <superviz-comments-comment-input
        @create-annotation=${this.createComment}
        eventType="create-annotation"
        @comment-input-ready=${this.focusInput}
        participantsList=${JSON.stringify(this.participantsList)}
      >
      </superviz-comments-comment-input>
    </div>`},this.position={x:0,y:0},setTimeout(()=>{this.firstLoad=!1},800)}updated(t){super.updated(t),!(!t.has("movedPosition")||!this.annotationSides)&&(this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide(),this.inputElement&&this.focusInput())}firstUpdated(t){var n;super.firstUpdated(t),a.n.call(this,["comments"]),this.showInput&&(this.originalPosition=(0,o.x)({},this.position),this.pinAnnotation=null==(n=this.shadowRoot)?void 0:n.querySelector(".comments__annotation-pin"),this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide())}connectedCallback(){if(super.connectedCallback(),"add"!==this.type)return;let{localParticipant:t}=this.useStore("global-store");t.subscribe(t=>{var n;this.localAvatar=null==(n=null==t?void 0:t.avatar)?void 0:n.imageUrl,this.localName=null==t?void 0:t.name}),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",t=>{"Escape"===t.key&&this.cancelTemporaryAnnotationEsc(t)})}disconnectedCallback(){super.disconnectedCallback(),"add"===this.type&&(window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{"Escape"===t.key&&this.cancelTemporaryAnnotationEsc(t)}))}get userAvatar(){var t,n,i,e;return(null==(e=null==(i=null==(n=null==(t=this.annotation)?void 0:t.comments)?void 0:n.at(0))?void 0:i.participant)?void 0:e.avatar)||this.localAvatar}get userInitial(){var t,n,i,e,o;return((null!=(o=null==(e=null==(i=null==(n=null==(t=this.annotation)?void 0:t.comments)?void 0:n.at(0))?void 0:i.participant)?void 0:e.name)?o:this.localName)||"Anonymous")[0].toUpperCase()}emitClick(){var t;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:null==(t=this.annotation)?void 0:t.uuid}}))}render(){let t={"comments__annotation-pin":!0,preload:void 0===this.firstLoad,"comments__annotation-pin--active":this.active,"comments__cursor-pointer":"add"===this.type&&!this.showInput,"comments__annotation-pin--add":"add"===this.type&&this.showInput,[this.horizontalSide]:!0},n={"comments__annotation-pin-wrapper":!0,"comments__annotation-pin-wrapper--new":this.newPin},i=this.keepPositionRatio?"%":"px",e=`top: ${this.position.y}${i}; left: ${this.position.x}${i};`;return"add"===this.type?(0,l.V)`
        <div class=${(0,s.u)(t)} style=${e}>${this.avatar()} ${this.input()}</div>
      `:(0,l.V)`<div class=${(0,s.u)(n)} style=${e}>
      <div @click=${this.emitClick} class=${(0,s.u)(t)}>${this.avatar()}</div>
    </div> `}};p.styles=c,p.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean},showInput:{type:Boolean},containerSides:{type:Object},horizontalSide:{type:String},commentsSide:{type:String},movedPosition:{type:String},pinAnnotation:{type:Object},localAvatar:{type:String},annotationSent:{type:Boolean},localName:{type:String},keepPositionRatio:{type:Boolean},participantsList:{type:Object},firstLoad:{type:Boolean},newPin:{type:Boolean}},p=(0,o.D)([(0,l.t)("superviz-comments-annotation-pin")],p)},3128:(t,n,i)=>{i.d(n,{E:()=>e,a:()=>o,i:()=>s}),(0,i(6955).e)();var e={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},o=t=>(...n)=>({_$litDirective$:t,values:n}),s=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,i){this.t=t,this._$AM=n,this.i=i}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}},459:(t,n,i)=>{function e(t){let n=document.getElementById(`superviz-${t}-styles`);if(!n)return;let i=new CSSStyleSheet;i.replaceSync(n.textContent),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,i]}i.d(n,{n:()=>e}),(0,i(6955).e)()},746:(t,n,i)=>{i.d(n,{u:()=>a});var e=i(3128),o=i(7128),s=i(6955);(0,s.e)();var a=(0,e.a)(class extends e.i{constructor(t){var n;if(super(t),t.type!==e.E.ATTRIBUTE||"class"!==t.name||(null==(n=t.strings)?void 0:n.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(n=>t[n]).join(" ")+" "}update(t,[n]){var i,e;if(void 0===this.st){for(let e in this.st=new Set,void 0!==t.strings&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter(t=>""!==t))),n)n[e]&&!(null!=(i=this.nt)&&i.has(e))&&this.st.add(e);return this.render(n)}let s=t.element.classList;for(let t of this.st)t in n||(s.remove(t),this.st.delete(t));for(let t in n){let i=!!n[t];i===this.st.has(t)||null!=(e=this.nt)&&e.has(t)||(i?(s.add(t),this.st.add(t)):(s.remove(t),this.st.delete(t)))}return o.E}});(0,s.e)()}};