"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5600],{2521:function(e,t,s){s.d(t,{P9:function(){return eJ},Zj:function(){return eD},Db:function(){return ez},NE:function(){return e2},aM:function(){return eK}});for(var r,i,n=s(7621),o=[],a=[],u=Uint8Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,l=h.length;c<l;++c)o[c]=h[c],a[h.charCodeAt(c)]=c;function d(e){var t,s,r=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");-1===s&&(s=t);var r=s===t?0:4-s%4;return[s,r]}(e),i=r[0],n=r[1],o=new u((i+n)*3/4-n),h=0,c=n>0?i-4:i;for(s=0;s<c;s+=4)t=a[e.charCodeAt(s)]<<18|a[e.charCodeAt(s+1)]<<12|a[e.charCodeAt(s+2)]<<6|a[e.charCodeAt(s+3)],o[h++]=t>>16&255,o[h++]=t>>8&255,o[h++]=255&t;return 2===n&&(t=a[e.charCodeAt(s)]<<2|a[e.charCodeAt(s+1)]>>4,o[h++]=255&t),1===n&&(t=a[e.charCodeAt(s)]<<10|a[e.charCodeAt(s+1)]<<4|a[e.charCodeAt(s+2)]>>2,o[h++]=t>>8&255,o[h++]=255&t),o}function f(e){for(var t,s=e.length,r=s%3,i=[],n=0,a=s-r;n<a;n+=16383)i.push(function(e,t,s){for(var r,i=[],n=t;n<s;n+=3)i.push(o[(r=(e[n]<<16&16711680)+(e[n+1]<<8&65280)+(255&e[n+2]))>>18&63]+o[r>>12&63]+o[r>>6&63]+o[63&r]);return i.join("")}(e,n,n+16383>a?a:n+16383));return 1===r?i.push(o[(t=e[s-1])>>2]+o[t<<4&63]+"=="):2===r&&i.push(o[(t=(e[s-2]<<8)+e[s-1])>>10]+o[t>>4&63]+o[t<<2&63]+"="),i.join("")}function g(e){if(void 0===e)return{};if(!y(e))throw Error(`The arguments to a Convex function must be an object. Received: ${e}`);return e}function y(e){let t="object"==typeof e,s=Object.getPrototypeOf(e),r=null===s||s===Object.prototype||s?.constructor?.name==="Object";return t&&r}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63;let p=BigInt("-9223372036854775808"),m=BigInt("9223372036854775807"),v=BigInt("0"),b=BigInt("8"),w=BigInt("256");function S(e){return Number.isNaN(e)||!Number.isFinite(e)||Object.is(e,-0)}let k=DataView.prototype.setBigInt64?function(e){if(e<p||m<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);let t=new ArrayBuffer(8);return new DataView(t).setBigInt64(0,e,!0),f(new Uint8Array(t))}:function(e){e<v&&(e-=p+p);let t=e.toString(16);t.length%2==1&&(t="0"+t);let s=new Uint8Array(new ArrayBuffer(8)),r=0;for(let i of t.match(/.{2}/g).reverse())s.set([parseInt(i,16)],r++),e>>=b;return f(s)},R=DataView.prototype.getBigInt64?function(e){let t=d(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);return new DataView(t.buffer).getBigInt64(0,!0)}:function(e){let t=d(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let s=v,r=v;for(let e of t)s+=BigInt(e)*w**r,r++;return s>m&&(s+=p+p),s};function q(e){if(e.length>1024)throw Error(`Field name ${e} exceeds maximum field name length 1024.`);if(e.startsWith("$"))throw Error(`Field name ${e} starts with a '$', which is reserved.`);for(let t=0;t<e.length;t+=1){let s=e.charCodeAt(t);if(s<32||s>=127)throw Error(`Field name ${e} has invalid character '${e[t]}': Field names can only contain non-control ASCII characters`)}}function A(e){if(null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>A(e));if("object"!=typeof e)throw Error(`Unexpected type of ${e}`);let t=Object.entries(e);if(1===t.length){let s=t[0][0];if("$bytes"===s){if("string"!=typeof e.$bytes)throw Error(`Malformed $bytes field on ${e}`);return d(e.$bytes).buffer}if("$integer"===s){if("string"!=typeof e.$integer)throw Error(`Malformed $integer field on ${e}`);return R(e.$integer)}if("$float"===s){if("string"!=typeof e.$float)throw Error(`Malformed $float field on ${e}`);let t=d(e.$float);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $float`);let s=new DataView(t.buffer).getFloat64(0,!0);if(!S(s))throw Error(`Float ${s} should be encoded as a number`);return s}if("$set"===s)throw Error("Received a Set which is no longer supported as a Convex type.");if("$map"===s)throw Error("Received a Map which is no longer supported as a Convex type.")}let s={};for(let[t,r]of Object.entries(e))q(t),s[t]=A(r);return s}function C(e){return JSON.stringify(e,(e,t)=>void 0===t?"undefined":"bigint"==typeof t?`${t.toString()}n`:t)}function T(e,t,s,r){return e?`${t}${C(s)} is not a supported Convex type (present at path ${e} in original object ${C(r)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${t}${C(s)} is not a supported Convex type.`}function x(e){return function e(t,s,r,i){if(void 0===t){let e=r&&` (present at path ${r} in original object ${C(s)})`;throw Error(`undefined is not a valid Convex value${e}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(null===t)return t;if("bigint"==typeof t){if(t<p||m<t)throw Error(`BigInt ${t} does not fit into a 64-bit signed integer.`);return{$integer:k(t)}}if("number"==typeof t){if(!S(t))return t;{let e=new ArrayBuffer(8);return new DataView(e).setFloat64(0,t,!0),{$float:f(new Uint8Array(e))}}}if("boolean"==typeof t||"string"==typeof t)return t;if(t instanceof ArrayBuffer)return{$bytes:f(new Uint8Array(t))};if(Array.isArray(t))return t.map((t,i)=>e(t,s,r+`[${i}]`,!1));if(t instanceof Set)throw Error(T(r,"Set",[...t],s));if(t instanceof Map)throw Error(T(r,"Map",[...t],s));if(!y(t)){let e=t?.constructor?.name;throw Error(T(r,e?`${e} `:"",t,s))}let n={},o=Object.entries(t);for(let[t,a]of(o.sort(([e,t],[s,r])=>e===s?0:e<s?-1:1),o))void 0!==a?(q(t),n[t]=e(a,s,r+`.${t}`,!1)):i&&(q(t),n[t]=function(t,s,r){if(void 0===t)return{$undefined:null};if(void 0===s)throw Error(`Programming error. Current value is ${C(t)} but original value is undefined`);return e(t,s,r,!1)}(a,s,r+`.${t}`));return n}(e,e,"",!1)}var M=Object.defineProperty,I=(e,t,s)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,O=(e,t,s)=>I(e,"symbol"!=typeof t?t+"":t,s);let E=Symbol.for("ConvexError");class $ extends(i=Error,r=E,i){constructor(e){super("string"==typeof e?e:C(e)),O(this,"name","ConvexError"),O(this,"data"),O(this,r,!0),this.data=e}}let L="1.17.0";var Q=Object.defineProperty,V=(e,t,s)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,P=(e,t,s)=>V(e,"symbol"!=typeof t?t+"":t,s);function _(e){switch(e){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class j{constructor(e){P(this,"_onLogLineFuncs"),P(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let e=0;e<10&&void 0!==this._onLogLineFuncs[t];e++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(let t of Object.values(this._onLogLineFuncs))t("debug",`${new Date().toISOString()}`,...e)}log(...e){for(let t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(let t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(let t of Object.values(this._onLogLineFuncs))t("error",...e)}}function N(e){let t=new j(e);return t.addLogLineListener((e,...t)=>{switch(e){case"debug":console.debug(...t);break;case"info":default:console.log(...t);break;case"warn":console.warn(...t);break;case"error":console.error(...t)}}),t}function F(e,t,s,r,i){let n=_(s);if("object"==typeof i&&(i=`ConvexError ${JSON.stringify(i.errorData,null,2)}`),"info"===t){let t=i.match(/^\[.*?\] /);if(null===t){e.error(`[CONVEX ${n}(${r})] Could not parse console.log`);return}let s=i.slice(1,t[0].length-2),o=i.slice(t[0].length);e.log(`%c[CONVEX ${n}(${r})] [${s}]`,"color:rgb(0, 145, 255)",o)}else e.error(`[CONVEX ${n}(${r})] ${i}`)}function U(e,t,s){let r=_(e);return`[CONVEX ${r}(${t})] ${s.errorMessage}
  Called by client`}function D(e,t){return t.data=e.errorData,t}function B(e){let t,s;let r=e.split(":");return 1===r.length?(t=r[0],s="default"):(t=r.slice(0,r.length-1).join(":"),s=r[r.length-1]),t.endsWith(".js")&&(t=t.slice(0,-3)),`${t}:${s}`}function W(e,t){return JSON.stringify({udfPath:B(e),args:x(t)})}var J=Object.defineProperty,K=(e,t,s)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,z=(e,t,s)=>K(e,"symbol"!=typeof t?t+"":t,s);class H{constructor(){z(this,"nextQueryId"),z(this,"querySetVersion"),z(this,"querySet"),z(this,"queryIdToToken"),z(this,"identityVersion"),z(this,"auth"),z(this,"outstandingQueriesOlderThanRestart"),z(this,"outstandingAuthOlderThanRestart"),z(this,"paused"),z(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return 0===this.outstandingQueriesOlderThanRestart.size&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,s,r){let i=B(e),n=W(i,t),o=this.querySet.get(n);if(void 0!==o)return o.numSubscribers+=1,{queryToken:n,modification:null,unsubscribe:()=>this.removeSubscriber(n)};{let e=this.nextQueryId++;this.querySet.set(n,{id:e,canonicalizedUdfPath:i,args:t,numSubscribers:1,journal:s,componentPath:r}),this.queryIdToToken.set(e,n);let o=this.querySetVersion,a=this.querySetVersion+1,u={type:"Add",queryId:e,udfPath:i,args:[x(t)],journal:s,componentPath:r};return this.paused?this.pendingQuerySetModifications.set(e,u):this.querySetVersion=a,{queryToken:n,modification:{type:"ModifyQuerySet",baseVersion:o,newVersion:a,modifications:[u]},unsubscribe:()=>this.removeSubscriber(n)}}}transition(e){for(let t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);let e=t.journal;if(void 0!==e){let s=this.queryIdToToken.get(t.queryId);void 0!==s&&(this.querySet.get(s).journal=e)}break}case"QueryRemoved":this.outstandingQueriesOlderThanRestart.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}}queryId(e,t){let s=W(B(e),t),r=this.querySet.get(s);return void 0!==r?r.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}setAuth(e){this.auth={tokenType:"User",value:e};let t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){let s={tokenType:"Admin",value:e,impersonating:t};this.auth=s;let r=this.identityVersion;return this.paused||(this.identityVersion=r+1),{type:"Authenticate",baseVersion:r,...s}}clearAuth(){this.auth=void 0,this.markAuthCompletion();let e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();let t=[];for(let s of this.querySet.values()){let r={type:"Add",queryId:s.id,udfPath:s.canonicalizedUdfPath,args:[x(s.args)],journal:s.journal,componentPath:s.componentPath};t.push(r),e.has(s.id)||this.outstandingQueriesOlderThanRestart.add(s.id)}this.querySetVersion=1;let s={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[s,void 0];this.outstandingAuthOlderThanRestart=!0;let r={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[s,r]}pause(){this.paused=!0}resume(){let e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=void 0!==this.auth?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){let t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);let s=this.querySetVersion,r=this.querySetVersion+1,i={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,i):this.querySetVersion=r,{type:"ModifyQuerySet",baseVersion:s,newVersion:r,modifications:[i]}}}}var X=Object.defineProperty,G=(e,t,s)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Y=(e,t,s)=>G(e,"symbol"!=typeof t?t+"":t,s);class Z{constructor(e){this.logger=e,Y(this,"inflightRequests"),Y(this,"requestsOlderThanRestart"),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){return new Promise(s=>{this.inflightRequests.set(e.requestId,{message:e,status:{status:t?"Requested":"NotSent",requestedAt:new Date,onResult:s}})})}onResponse(e){let t;let s=this.inflightRequests.get(e.requestId);if(void 0===s||"Completed"===s.status.status)return null;let r="Mutation"===s.message.type?"mutation":"action",i=s.message.udfPath;for(let t of e.logLines)F(this.logger,"info",r,i,t);let n=s.status;if(e.success)t=()=>n.onResult({success:!0,logLines:e.logLines,value:A(e.result)});else{let s=e.result,{errorData:o}=e;F(this.logger,"error",r,i,s),t=()=>n.onResult({success:!1,errorMessage:s,errorData:void 0!==o?A(o):void 0,logLines:e.logLines})}return"ActionResponse"!==e.type&&e.success?(s.status={status:"Completed",ts:e.ts,onResolve:t},null):(t(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),e.requestId)}removeCompleted(e){let t=new Set;for(let[s,r]of this.inflightRequests.entries()){let i=r.status;"Completed"===i.status&&i.ts.lessThanOrEqual(e)&&(i.onResolve(),t.add(s),this.inflightRequests.delete(s),this.requestsOlderThanRestart.delete(s))}return t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());let e=[];for(let[t,s]of this.inflightRequests){if("NotSent"===s.status.status){s.status.status="Requested",e.push(s.message);continue}if("Mutation"===s.message.type)e.push(s.message);else{if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),"Completed"===s.status.status)throw Error("Action should never be in 'Completed' state");s.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return e}resume(){let e=[];for(let[,t]of this.inflightRequests)if("NotSent"===t.status.status){t.status.status="Requested",e.push(t.message);continue}return e}hasIncompleteRequests(){for(let e of this.inflightRequests.values())if("Requested"===e.status.status)return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return 0===this.requestsOlderThanRestart.size}timeOfOldestInflightRequest(){if(0===this.inflightRequests.size)return null;let e=Date.now();for(let t of this.inflightRequests.values())"Completed"!==t.status.status&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}}let ee=Symbol.for("functionName"),et=Symbol.for("toReferencePath");function es(e){let t=function(e){let t;if("string"==typeof e)t=e.startsWith("function://")?{functionHandle:e}:{name:e};else if(e[ee])t={name:e[ee]};else{let s=e[et]??null;if(!s)throw Error(`${e} is not a functionReference`);t={reference:s}}return t}(e);if(void 0===t.name){if(void 0!==t.functionHandle)throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${t.functionHandle}`);if(void 0!==t.reference)throw Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${t.reference}`);throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(t)}`)}if("string"==typeof e)return e;let s=e[ee];if(!s)throw Error(`${e} is not a functionReference`);return s}!function e(t=[]){return new Proxy({},{get(s,r){if("string"==typeof r)return e([...t,r]);if(r===ee){if(t.length<2){let e=["api",...t].join(".");throw Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${e}\``)}let e=t.slice(0,-1).join("/"),s=t[t.length-1];return"default"===s?e:e+":"+s}return r===Symbol.toStringTag?"FunctionReference":void 0}})}();var er=Object.defineProperty,ei=(e,t,s)=>t in e?er(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,en=(e,t,s)=>ei(e,"symbol"!=typeof t?t+"":t,s);class eo{constructor(e){en(this,"queryResults"),en(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){let s=g(t[0]),r=es(e),i=this.queryResults.get(W(r,s));if(void 0!==i)return eo.queryValue(i.result)}getAllQueries(e){let t=[],s=es(e);for(let e of this.queryResults.values())e.udfPath===B(s)&&t.push({args:e.args,value:eo.queryValue(e.result)});return t}setQuery(e,t,s){let r=g(t),i=es(e),n=W(i,r);this.queryResults.set(n,{udfPath:i,args:r,result:void 0===s?void 0:{success:!0,value:s,logLines:[]}}),this.modifiedQueries.push(n)}static queryValue(e){return void 0===e?void 0:e.success?e.value:void 0}}class ea{constructor(){en(this,"queryResults"),en(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(e=>!t.has(e.mutationId));let s=this.queryResults;this.queryResults=new Map(e);let r=new eo(this.queryResults);for(let e of this.optimisticUpdates)e.update(r);let i=[];for(let[e,t]of this.queryResults){let r=s.get(e);(void 0===r||r.result!==t.result)&&i.push(e)}return i}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});let s=new eo(this.queryResults);return e(s),s.modifiedQueries}queryResult(e){let t=this.queryResults.get(e);if(void 0===t)return;let s=t.result;if(void 0!==s){if(s.success)return s.value;if(void 0!==s.errorData)throw D(s,new $(U("query",t.udfPath,s)));throw Error(U("query",t.udfPath,s))}}hasQueryResult(e){return void 0!==this.queryResults.get(e)}queryLogs(e){let t=this.queryResults.get(e);return t?.result?.logLines}}var eu=Object.defineProperty,eh=(e,t,s)=>t in e?eu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ec=(e,t,s)=>eh(e,"symbol"!=typeof t?t+"":t,s);class el{constructor(e,t){ec(this,"low"),ec(this,"high"),ec(this,"__isUnsignedLong__"),this.low=0|e,this.high=0|t,this.__isUnsignedLong__=!0}static isLong(e){return!0===(e&&e.__isUnsignedLong__)}static fromBytesLE(e){return new el(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?ed:e>=eg?ey:new el(e%ef|0,e/ef|0)}toString(){return(BigInt(this.high)*BigInt(ef)+BigInt(this.low)).toString()}equals(e){return el.isLong(e)||(e=el.fromValue(e)),(this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return(el.isLong(e)||(e=el.fromValue(e)),this.equals(e))?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return 0>=this.comp(e)}static fromValue(e){return"number"==typeof e?el.fromNumber(e):new el(e.low,e.high)}}let ed=new el(0,0),ef=4294967296,eg=18446744073709552e3,ey=new el(-1,-1);var ep=Object.defineProperty,em=(e,t,s)=>t in e?ep(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ev=(e,t,s)=>em(e,"symbol"!=typeof t?t+"":t,s);class eb{constructor(e,t){ev(this,"version"),ev(this,"remoteQuerySet"),ev(this,"queryPath"),ev(this,"logger"),this.version={querySet:0,ts:el.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){let t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}`);for(let t of e.modifications)switch(t.type){case"QueryUpdated":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)F(this.logger,"info","query",e,s);let s=A(t.value??null);this.remoteQuerySet.set(t.queryId,{success:!0,value:s,logLines:t.logLines});break}case"QueryFailed":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)F(this.logger,"info","query",e,s);let{errorData:s}=t;this.remoteQuerySet.set(t.queryId,{success:!1,errorMessage:t.errorMessage,errorData:void 0!==s?A(s):void 0,logLines:t.logLines});break}case"QueryRemoved":this.remoteQuerySet.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}function ew(e){let t=d(e);return el.fromBytesLE(Array.from(t))}var eS=Object.defineProperty,ek=(e,t,s)=>t in e?eS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,eR=(e,t,s)=>ek(e,"symbol"!=typeof t?t+"":t,s);class eq{constructor(e,t,s,r){eR(this,"socket"),eR(this,"connectionCount"),eR(this,"lastCloseReason"),eR(this,"initialBackoff"),eR(this,"maxBackoff"),eR(this,"retries"),eR(this,"serverInactivityThreshold"),eR(this,"reconnectDueToServerInactivityTimeout"),eR(this,"uri"),eR(this,"onOpen"),eR(this,"onResume"),eR(this,"onMessage"),eR(this,"webSocketConstructor"),eR(this,"logger"),this.webSocketConstructor=s,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.initialBackoff=100,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=3e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.logger=r,this.connect()}connect(){if("terminated"===this.socket.state)return;if("disconnected"!==this.socket.state&&"stopped"!==this.socket.state)throw Error("Didn't start connection from disconnected state: "+this.socket.state);let e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.socket={state:"connecting",ws:e,paused:"no"},this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),"connecting"!==this.socket.state)throw Error("onopen called with socket not in connecting state");this.socket={state:"ready",ws:e,paused:"yes"===this.socket.paused?"uninitialized":"no"},this.resetServerInactivityTimeout(),"no"===this.socket.paused&&this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason}),"InitialConnect"!==this.lastCloseReason&&this.logger.log("WebSocket reconnected"),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=e=>{let t=e.message;this.logger.log(`WebSocket error: ${t}`)},e.onmessage=e=>{this.resetServerInactivityTimeout();let t=function(e){switch(e.type){case"FatalError":case"AuthError":case"ActionResponse":case"Ping":return{...e};case"MutationResponse":if(e.success)return{...e,ts:ew(e.ts)};return{...e};case"Transition":return{...e,startVersion:{...e.startVersion,ts:ew(e.startVersion.ts)},endVersion:{...e.endVersion,ts:ew(e.endVersion.ts)}}}}(JSON.parse(e.data));this._logVerbose(`received ws message with type ${t.type}`),this.onMessage(t).hasSyncedPastLastReconnect&&(this.retries=0)},e.onclose=e=>{if(this._logVerbose("begin ws.onclose"),null===this.lastCloseReason&&(this.lastCloseReason=e.reason??"OnCloseInvoked"),1e3!==e.code&&1001!==e.code&&1005!==e.code&&4040!==e.code){let t=`WebSocket closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.logger.log(t)}this.scheduleReconnect()}}socketState(){return this.socket.state}sendMessage(e){if(this._logVerbose(`sending message with type ${e.type}`),"ready"===this.socket.state&&"no"===this.socket.paused){let t=JSON.stringify(function(e){switch(e.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...e};case"Connect":if(void 0===e.maxObservedTimestamp)return{...e,maxObservedTimestamp:void 0};return{...e,maxObservedTimestamp:f(new Uint8Array(e.maxObservedTimestamp.toBytesLE()))}}}(e));try{this.socket.ws.send(t)}catch(e){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${e}`),this.closeAndReconnect("FailedToSendMessage")}return!0}return!1}resetServerInactivityTimeout(){"terminated"!==this.socket.state&&(null!==this.reconnectDueToServerInactivityTimeout&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(){this.socket={state:"disconnected"};let e=this.nextBackoff();this.logger.log(`Attempting reconnect in ${e}ms`),setTimeout(()=>this.connect(),e)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":this.lastCloseReason=e,this.close(),this.scheduleReconnect();return;default:this.socket}}close(){switch(this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{let e=this.socket.ws;return new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");let e=this.socket.ws,t=new Promise(t=>{e.onclose=()=>{t()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{let e=this.close();return this.socket={state:"terminated"},e}default:throw this.socket,Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{let e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}restart(){switch(this.socket.state){case"stopped":break;case"terminated":return;case"connecting":case"ready":case"disconnected":throw Error("`restart()` is only valid after `stop()`");default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":this.socket={...this.socket,paused:"yes"};return;default:this.socket;return}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":"uninitialized"===this.socket.paused?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason})):"yes"===this.socket.paused&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(){let e=this.initialBackoff*Math.pow(2,this.retries);this.retries+=1;let t=Math.min(e,this.maxBackoff);return t+t*(Math.random()-.5)}}function eA(e){this.message=e}eA.prototype=Error(),eA.prototype.name="InvalidCharacterError";var eC="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new eA("'atob' failed: The string to be decoded is not correctly encoded.");for(var s,r,i=0,n=0,o="";r=t.charAt(n++);~r&&(s=i%4?64*s+r:r,i++%4)&&(o+=String.fromCharCode(255&s>>(-2*i&6))))r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o};function eT(e){this.message=e}eT.prototype=Error(),eT.prototype.name="InvalidTokenError";var ex=function(e,t){if("string"!=typeof e)throw new eT("Invalid token specified");var s=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t,s=e.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw"Illegal base64url string!"}try{return t=s,decodeURIComponent(eC(t).replace(/(.)/g,function(e,t){var s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(e){return eC(s)}}(e.split(".")[s]))}catch(e){throw new eT("Invalid token specified: "+e.message)}},eM=Object.defineProperty,eI=(e,t,s)=>t in e?eM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,eO=(e,t,s)=>eI(e,"symbol"!=typeof t?t+"":t,s);class eE{constructor(e,t,s){eO(this,"authState",{state:"noAuth"}),eO(this,"configVersion",0),eO(this,"syncState"),eO(this,"authenticate"),eO(this,"stopSocket"),eO(this,"restartSocket"),eO(this,"pauseSocket"),eO(this,"resumeSocket"),eO(this,"clearAuth"),eO(this,"logger"),eO(this,"refreshTokenLeewaySeconds"),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.restartSocket=t.restartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=s.logger,this.refreshTokenLeewaySeconds=s.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();let s=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});s.isFromOutdatedConfig||(s.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(s.value),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket()):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()))}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if("waitingForServerConfirmationOfCachedToken"===this.authState.state){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}"waitingForServerConfirmationOfFreshToken"!==this.authState.state||(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){let{baseVersion:t}=e;if(null!=t){if(!this.syncState.isCurrentOrNewerAuthVersion(t+1)){this._logVerbose("ignoring auth error for previous auth attempt");return}this.tryToReauthenticate(e);return}this.tryToReauthenticate(e)}async tryToReauthenticate(e){if("noAuth"===this.authState.state||"waitingForServerConfirmationOfFreshToken"===this.authState.state){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),"noAuth"!==this.authState.state&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}this._logVerbose("attempting to reauthenticate"),await this.stopSocket();let t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:"notRefetching"===this.authState.state||"waitingForScheduledRefetch"===this.authState.state})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.restartSocket())}async refetchToken(){if("noAuth"===this.authState.state)return;this._logVerbose("refetching auth token");let e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("resuming WS after auth token fetch (if currently paused)"),this.resumeSocket())}scheduleTokenRefetch(e){if("noAuth"===this.authState.state)return;let t=this.decodeToken(e);if(!t){this.logger.error("Auth token is not a valid JWT, cannot refetch the token");return}let{iat:s,exp:r}=t;if(!s||!r){this.logger.error("Auth token does not have required fields, cannot refetch the token");return}let i=r-s;if(i<=2){this.logger.error("Auth token does not live long enough, cannot refetch the token");return}let n=Math.min(1728e6,(i-this.refreshTokenLeewaySeconds)*1e3);n<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${i}s`),n=0);let o=setTimeout(()=>{this.refetchToken()},n);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:o,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${n}ms`)}async fetchTokenAndGuardAgainstRace(e,t){let s=++this.configVersion,r=await e(t);return this.configVersion!==s?{isFromOutdatedConfig:!0}:{isFromOutdatedConfig:!1,value:r}}stop(){this.resetAuthState(),this.configVersion++}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){"waitingForScheduledRefetch"===this.authState.state&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return ex(e)}catch(e){return this._logVerbose(`Error decoding token: ${e instanceof Error?e.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}let e$=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function eL(e){let t=e.name.slice(6);return{name:t=t.charAt(0).toLowerCase()+t.slice(1),startTime:e.startTime}}var eQ=Object.defineProperty,eV=(e,t,s)=>t in e?eQ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,eP=(e,t,s)=>eV(e,"symbol"!=typeof t?t+"":t,s);class e_{constructor(e,t,s){let r;if(eP(this,"address"),eP(this,"state"),eP(this,"requestManager"),eP(this,"webSocketManager"),eP(this,"authenticationManager"),eP(this,"remoteQuerySet"),eP(this,"optimisticQueryResults"),eP(this,"onTransition"),eP(this,"_nextRequestId"),eP(this,"_sessionId"),eP(this,"firstMessageReceived",!1),eP(this,"debug"),eP(this,"logger"),eP(this,"maxObservedTimestamp"),eP(this,"mark",e=>{if(this.debug){var t;t=this.sessionId,"undefined"!=typeof performance&&performance.mark&&performance.mark(e,{detail:{sessionId:t}})}}),"object"==typeof e)throw Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");s?.skipConvexDeploymentUrlCheck!==!0&&function(e){if(void 0===e)throw Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if("string"!=typeof e)throw Error(`Invalid deployment address: found ${e}".`);if(!(e.startsWith("http:")||e.startsWith("https:")))throw Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${e}".`);try{new URL(e)}catch{throw Error(`Invalid deployment address: "${e}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(e.endsWith(".convex.site"))throw Error(`Invalid deployment address: "${e}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}(e);let i=(s={...s}).authRefreshTokenLeewaySeconds??2,n=s.webSocketConstructor;if(!n&&"undefined"==typeof WebSocket)throw Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");n=n||WebSocket,this.debug=s.reportDebugInfoToConvex??!1,this.address=e,this.logger=s.logger??N({verbose:s.verbose??!1});let o=e.search("://");if(-1===o)throw Error("Provided address was not an absolute URL.");let a=e.substring(o+3),u=e.substring(0,o);if("http"===u)r="ws";else if("https"===u)r="wss";else throw Error(`Unknown parent protocol ${u}`);let h=`${r}://${a}/api/${L}/sync`;this.state=new H,this.remoteQuerySet=new eb(e=>this.state.queryPath(e),this.logger),this.requestManager=new Z(this.logger),this.authenticationManager=new eE(this.state,{authenticate:e=>{let t=this.state.setAuth(e);this.webSocketManager.sendMessage(t)},stopSocket:()=>this.webSocketManager.stop(),restartSocket:()=>this.webSocketManager.restart(),pauseSocket:()=>{this.webSocketManager.pause(),this.state.pause()},resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:i}),this.optimisticQueryResults=new ea,this.onTransition=t,this._nextRequestId=0,this._sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});let{unsavedChangesWarning:c}=s;if("undefined"==typeof window||void 0===window.addEventListener){if(!0===c)throw Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else!1!==c&&window.addEventListener("beforeunload",e=>{if(this.requestManager.hasIncompleteRequests()){e.preventDefault();let t="Are you sure you want to leave? Your changes may not be saved.";return(e||window.event).returnValue=t,t}});this.webSocketManager=new eq(h,{onOpen:e=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...e,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});let t=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new eb(e=>this.state.queryPath(e),this.logger);let[s,r]=this.state.restart(t);for(let e of(r&&this.webSocketManager.sendMessage(r),this.webSocketManager.sendMessage(s),this.requestManager.restart()))this.webSocketManager.sendMessage(e)},onResume:()=>{let[e,t]=this.state.resume();for(let s of(t&&this.webSocketManager.sendMessage(t),e&&this.webSocketManager.sendMessage(e),this.requestManager.resume()))this.webSocketManager.sendMessage(s)},onMessage:e=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),e.type){case"Transition":{this.observedTimestamp(e.endVersion.ts),this.authenticationManager.onTransition(e),this.remoteQuerySet.transition(e),this.state.transition(e);let t=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(t);break}case"MutationResponse":{e.success&&this.observedTimestamp(e.ts);let t=this.requestManager.onResponse(e);null!==t&&this.notifyOnQueryResultChanges(new Set([t]));break}case"ActionResponse":this.requestManager.onResponse(e);break;case"AuthError":this.authenticationManager.onAuthError(e);break;case"FatalError":{let t=function(e,t){let s=`[CONVEX FATAL ERROR] ${t}`;return e.error(s),Error(s)}(this.logger,e.error);throw this.webSocketManager.terminate(),t}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}}},n,this.logger),this.mark("convexClientConstructed")}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(e){(void 0===this.maxObservedTimestamp||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){let t=this.remoteQuerySet.remoteQueryResults(),s=new Map;for(let[e,r]of t){let t=this.state.queryToken(e);if(null!==t){let i={result:r,udfPath:this.state.queryPath(e),args:this.state.queryArgs(e)};s.set(t,i)}}this.onTransition(this.optimisticQueryResults.ingestQueryResultsFromServer(s,e))}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){let s=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(s)}clearAuth(){let e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,s){let r=g(t),{modification:i,queryToken:n,unsubscribe:o}=this.state.subscribe(e,r,s?.journal,s?.componentPath);return null!==i&&this.webSocketManager.sendMessage(i),{queryToken:n,unsubscribe:()=>{let e=o();e&&this.webSocketManager.sendMessage(e)}}}localQueryResult(e,t){let s=W(e,g(t));return this.optimisticQueryResults.queryResult(s)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){let s=W(e,g(t));return this.optimisticQueryResults.queryLogs(s)}queryJournal(e,t){let s=W(e,g(t));return this.state.queryJournal(s)}connectionState(){return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:"ready"===this.webSocketManager.socketState(),timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest()}}async mutation(e,t,s){let r=await this.mutationInternal(e,t,s);if(!r.success){if(void 0!==r.errorData)throw D(r,new $(U("mutation",e,r)));throw Error(U("mutation",e,r))}return r.value}async mutationInternal(e,t,s,r){let i=g(t);this.tryReportLongDisconnect();let n=this.nextRequestId;if(this._nextRequestId++,void 0!==s){let e=s.optimisticUpdate;if(void 0!==e){let t=this.optimisticQueryResults.applyOptimisticUpdate(t=>{e(t,i)},n);this.onTransition(t)}}let o={type:"Mutation",requestId:n,udfPath:e,componentPath:r,args:[x(i)]},a=this.webSocketManager.sendMessage(o);return this.requestManager.request(o,a)}async action(e,t){let s=await this.actionInternal(e,t);if(!s.success){if(void 0!==s.errorData)throw D(s,new $(U("action",e,s)));throw Error(U("action",e,s))}return s.value}async actionInternal(e,t,s){let r=g(t),i=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();let n={type:"Action",requestId:i,udfPath:e,componentPath:s,args:[x(r)]},o=this.webSocketManager.sendMessage(n);return this.requestManager.request(n,o)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){let e=function(e){if("undefined"==typeof performance||!performance.getEntriesByName)return[];let t=[];for(let s of e$){let r=performance.getEntriesByName(s).filter(e=>"mark"===e.entryType).filter(t=>t.detail.sessionId===e);t.push(...r)}return t.map(eL)}(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;let e=this.connectionState().timeOfOldestInflightRequest;null===e||Date.now()-e.getTime()<=6e4||fetch(`${this.address}/api/debug_event`,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${L}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(e=>{e.ok||this.logger.warn("Analytics request failed with response:",e.body)}).catch(e=>{this.logger.warn("Analytics response failed with error:",e)})}}var ej=s(4310),eN=Object.defineProperty,eF=(e,t,s)=>t in e?eN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,eU=(e,t,s)=>eF(e,"symbol"!=typeof t?t+"":t,s);if(void 0===n)throw Error("Required dependency 'react' not found");if(void 0===ej)throw Error("Required dependency 'react-dom' not found");class eD{constructor(e,t){if(eU(this,"address"),eU(this,"cachedSync"),eU(this,"listeners"),eU(this,"options"),eU(this,"closed",!1),eU(this,"_logger"),eU(this,"adminAuth"),eU(this,"fakeUserIdentity"),void 0===e)throw Error("No address provided to ConvexReactClient.\nIf trying to deploy to production, make sure to follow all the instructions found at https://docs.convex.dev/production/hosting/\nIf running locally, make sure to run `convex dev` and ensure the .env.local file is populated.");if("string"!=typeof e)throw Error(`ConvexReactClient requires a URL like 'https://happy-otter-123.convex.cloud', received something of type ${typeof e} instead.`);if(!e.includes("://"))throw Error("Provided address was not an absolute URL.");this.address=e,this.listeners=new Map,this._logger=t?.logger??N({verbose:t?.verbose??!1}),this.options={...t,logger:this._logger}}get sync(){if(this.closed)throw Error("ConvexReactClient has already been closed.");return this.cachedSync||(this.cachedSync=new e_(this.address,e=>this.transition(e),this.options),this.adminAuth&&this.cachedSync.setAdminAuth(this.adminAuth,this.fakeUserIdentity)),this.cachedSync}setAuth(e,t){if("string"==typeof e)throw Error("Passing a string to ConvexReactClient.setAuth is no longer supported, please upgrade to passing in an async function to handle reauthentication.");this.sync.setAuth(e,t??(()=>{}))}clearAuth(){this.sync.clearAuth()}setAdminAuth(e,t){if(this.adminAuth=e,this.fakeUserIdentity=t,this.closed)throw Error("ConvexReactClient has already been closed.");this.cachedSync&&this.sync.setAdminAuth(e,t)}watchQuery(e,...t){let[s,r]=t,i=es(e);return{onUpdate:e=>{let{queryToken:t,unsubscribe:n}=this.sync.subscribe(i,s,r),o=this.listeners.get(t);return void 0!==o?o.add(e):this.listeners.set(t,new Set([e])),()=>{if(this.closed)return;let s=this.listeners.get(t);s.delete(e),0===s.size&&this.listeners.delete(t),n()}},localQueryResult:()=>{if(this.cachedSync)return this.cachedSync.localQueryResult(i,s)},localQueryLogs:()=>{if(this.cachedSync)return this.cachedSync.localQueryLogs(i,s)},journal:()=>{if(this.cachedSync)return this.cachedSync.queryJournal(i,s)}}}mutation(e,...t){let[s,r]=t,i=es(e);return this.sync.mutation(i,s,r)}action(e,...t){let s=es(e);return this.sync.action(s,...t)}query(e,...t){let s=this.watchQuery(e,...t),r=s.localQueryResult();return void 0!==r?Promise.resolve(r):new Promise((e,t)=>{let r=s.onUpdate(()=>{r();try{e(s.localQueryResult())}catch(e){t(e)}})})}connectionState(){return this.sync.connectionState()}get logger(){return this._logger}async close(){if(this.closed=!0,this.listeners=new Map,this.cachedSync){let e=this.cachedSync;this.cachedSync=void 0,await e.close()}}transition(e){ej.unstable_batchedUpdates(()=>{for(let t of e){let e=this.listeners.get(t);if(e)for(let t of e)t()}})}}let eB=n.createContext(void 0);function eW(){return(0,n.useContext)(eB)}let eJ=({client:e,children:t})=>n.createElement(eB.Provider,{value:e},t);function eK(e,...t){let s="skip"===t[0],r="skip"===t[0]?{}:g(t[0]),i="string"==typeof e?{[ee]:e}:e,o=es(i),a=eZ((0,n.useMemo)(()=>s?{}:{query:{query:i,args:r}},[JSON.stringify(x(r)),o,s])).query;if(a instanceof Error)throw a;return a}function ez(e){let t="string"==typeof e?{[ee]:e}:e,s=(0,n.useContext)(eB);if(void 0===s)throw Error("Could not find Convex client! `useMutation` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");return(0,n.useMemo)(()=>(function e(t,s,r){function i(e){return function(e){if("object"==typeof e&&null!==e&&"bubbles"in e&&"persist"in e&&"isDefaultPrevented"in e)throw Error("Convex function called with SyntheticEvent object. Did you use a Convex function as an event handler directly? Event handlers like onClick receive an event object as their first argument. These SyntheticEvent objects are not valid Convex values. Try wrapping the function like `const handler = () => myMutation();` and using `handler` in the event handler.")}(e),s.mutation(t,e,{optimisticUpdate:r})}return i.withOptimisticUpdate=function(i){if(void 0!==r)throw Error(`Already specified optimistic update for mutation ${es(t)}`);return e(t,s,i)},i})(t,s),[s,es(t)])}var eH=Object.defineProperty,eX=(e,t,s)=>t in e?eH(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,eG=(e,t,s)=>eX(e,"symbol"!=typeof t?t+"":t,s);class eY{constructor(e){eG(this,"createWatch"),eG(this,"queries"),eG(this,"listeners"),this.createWatch=e,this.queries={},this.listeners=new Set}setQueries(e){for(let t of Object.keys(e)){let{query:s,args:r}=e[t];if(es(s),void 0===this.queries[t])this.addQuery(t,s,r);else{let e=this.queries[t];(es(s)!==es(e.query)||JSON.stringify(x(r))!==JSON.stringify(x(e.args)))&&(this.removeQuery(t),this.addQuery(t,s,r))}}for(let t of Object.keys(this.queries))void 0===e[t]&&this.removeQuery(t)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}getLocalResults(e){let t={};for(let s of Object.keys(e)){let r;let{query:i,args:n}=e[s];es(i);let o=this.createWatch(i,n);try{r=o.localQueryResult()}catch(e){if(e instanceof Error)r=e;else throw e}t[s]=r}return t}setCreateWatch(e){for(let t of(this.createWatch=e,Object.keys(this.queries))){let{query:e,args:s,watch:r}=this.queries[t],i=r.journal();this.removeQuery(t),this.addQuery(t,e,s,i)}}destroy(){for(let e of Object.keys(this.queries))this.removeQuery(e);this.listeners=new Set}addQuery(e,t,s,r){if(void 0!==this.queries[e])throw Error(`Tried to add a new query with identifier ${e} when it already exists.`);let i=this.createWatch(t,s,r),n=i.onUpdate(()=>this.notifyListeners());this.queries[e]={query:t,args:s,watch:i,unsubscribe:n}}removeQuery(e){let t=this.queries[e];if(void 0===t)throw Error(`No query found with identifier ${e}.`);t.unsubscribe(),delete this.queries[e]}notifyListeners(){for(let e of this.listeners)e()}}function eZ(e){let t=eW();if(void 0===t)throw Error("Could not find Convex client! `useQuery` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");return function(e,t){let[s]=(0,n.useState)(()=>new eY(t));return s.createWatch!==t&&s.setCreateWatch(t),(0,n.useEffect)(()=>()=>s.destroy(),[s]),function({getCurrentValue:e,subscribe:t}){let[s,r]=(0,n.useState)(()=>({getCurrentValue:e,subscribe:t,value:e()})),i=s.value;return(s.getCurrentValue!==e||s.subscribe!==t)&&(i=e(),r({getCurrentValue:e,subscribe:t,value:i})),(0,n.useEffect)(()=>{let s=!1,i=()=>{s||r(s=>{if(s.getCurrentValue!==e||s.subscribe!==t)return s;let r=e();return s.value===r?s:{...s,value:r}})},n=t(i);return i(),()=>{s=!0,n()}},[e,t]),i}((0,n.useMemo)(()=>({getCurrentValue:()=>s.getLocalResults(e),subscribe:t=>(s.setQueries(e),s.subscribe(t))}),[s,e]))}(e,(0,n.useMemo)(()=>(e,s,r)=>t.watchQuery(e,s,{journal:r}),[t]))}let e0=(e,t,s)=>r=>{let i={...r.queries},n=r.nextPageKey,o=r.nextPageKey+1,a=r.nextPageKey+2;i[n]={query:r.query,args:{...r.args,paginationOpts:{...r.queries[e].args.paginationOpts,endCursor:t}}},i[o]={query:r.query,args:{...r.args,paginationOpts:{...r.queries[e].args.paginationOpts,cursor:t,endCursor:s}}};let u={...r.ongoingSplits};return u[e]=[n,o],{...r,nextPageKey:a,queries:i,ongoingSplits:u}},e1=e=>t=>{let s=t.ongoingSplits[e];if(void 0===s)return t;let r={...t.queries};delete r[e];let i={...t.ongoingSplits};delete i[e];let n=t.pageKeys.slice(),o=t.pageKeys.findIndex(t=>t===e);return o>=0&&(n=[...t.pageKeys.slice(0,o),...s,...t.pageKeys.slice(o+1)]),{...t,queries:r,pageKeys:n,ongoingSplits:i}};function e2(e,t,s){if("number"!=typeof s?.initialNumItems||s.initialNumItems<0)throw Error(`\`options.initialNumItems\` must be a positive number. Received \`${s?.initialNumItems}\`.`);let r="skip"===t,i=r?{}:t,o=es(e),a=(0,n.useMemo)(()=>()=>{let t=++e6;return{query:e,args:i,id:t,nextPageKey:1,pageKeys:r?[]:[0],queries:r?{}:{0:{query:e,args:{...i,paginationOpts:{numItems:s.initialNumItems,cursor:null,id:t}}}},ongoingSplits:{},skip:r}},[JSON.stringify(x(i)),o,s.initialNumItems,r]),[u,h]=(0,n.useState)(a),c=u;(es(e)!==es(u.query)||JSON.stringify(x(i))!==JSON.stringify(x(u.args))||r!==u.skip)&&h(c=a());let l=eW().logger,d=eZ(c.queries),[f,g]=(0,n.useMemo)(()=>{let e;let t=[];for(let r of c.pageKeys){if(void 0===(e=d[r]))break;if(e instanceof Error){if(e.message.includes("InvalidCursor"))return l.warn("usePaginatedQuery hit error, resetting pagination state: "+e.message),h(a),[[],void 0];throw e}let i=c.ongoingSplits[r];if(void 0!==i?void 0!==d[i[0]]&&void 0!==d[i[1]]&&h(e1(r)):e.splitCursor&&("SplitRecommended"===e.pageStatus||"SplitRequired"===e.pageStatus||e.page.length>2*s.initialNumItems)&&h(e0(r,e.splitCursor,e.continueCursor)),"SplitRequired"===e.pageStatus)return[t,void 0];t.push(...e.page)}return[t,e]},[d,c.pageKeys,c.ongoingSplits,s.initialNumItems,a,l]);return{results:f,...(0,n.useMemo)(()=>{if(void 0===g)return 1===c.nextPageKey?{status:"LoadingFirstPage",isLoading:!0,loadMore:e=>{}}:{status:"LoadingMore",isLoading:!0,loadMore:e=>{}};if(g.isDone)return{status:"Exhausted",isLoading:!1,loadMore:e=>{}};let e=g.continueCursor,t=!1;return{status:"CanLoadMore",isLoading:!1,loadMore:s=>{t||(t=!0,h(t=>{let r=[...t.pageKeys,t.nextPageKey],i={...t.queries};return i[t.nextPageKey]={query:t.query,args:{...t.args,paginationOpts:{numItems:s,cursor:e,id:t.id}}},{...t,nextPageKey:t.nextPageKey+1,pageKeys:r,queries:i}}))}}},[g,c.nextPageKey])}}let e6=0;(0,n.createContext)(void 0)},483:function(e,t,s){s.d(t,{U:function(){return u}});var r=s(7621);let i=e=>{let t;let s=new Set,r=(e,r)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),s.forEach(s=>s(t,e))}},i=()=>t,n={setState:r,getState:i,getInitialState:()=>o,subscribe:e=>(s.add(e),()=>s.delete(e))},o=t=e(r,i,n);return n},n=e=>e?i(e):i,o=e=>e,a=e=>{let t=n(e),s=e=>(function(e,t=o){let s=r.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return r.useDebugValue(s),s})(t,e);return Object.assign(s,t),s},u=e=>e?a(e):a}}]);